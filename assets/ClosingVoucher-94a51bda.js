import{d as L,k as J,I as q,D as G,i as H,C as K,l as _,c as g,r as Q,J as W,p as X,o as d,a as l,b as t,w as c,v as h,E as A,t as a,F as I,e as B,n as V,A as Y,f as E}from"./index-0d35fcb3.js";const Z={class:"space-y-6"},tt={key:0,class:"rounded-lg border border-gray-200 bg-white p-4 shadow-sm"},et={class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},st={class:"mt-4 flex justify-end"},ot=["disabled"],nt={key:1},rt={key:0,class:"rounded-lg border border-gray-200 bg-white p-4 shadow-sm"},at={class:"grid grid-cols-1 gap-4 sm:grid-cols-3"},it={class:"mt-1 text-sm font-medium text-gray-900"},dt={class:"mt-1 text-sm font-medium text-gray-900"},lt={class:"mt-1 text-sm font-medium text-gray-900"},ut={key:1,class:"rounded-lg border border-gray-200 bg-white p-4 text-sm text-gray-700"},gt={key:2,class:"rounded-lg border border-gray-200 bg-white p-4 shadow-sm"},xt={class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},mt=["value"],pt=["value"],ft={class:"mt-4 grid grid-cols-1 gap-4 sm:grid-cols-3"},ct={class:"rounded-lg border border-gray-100 bg-gray-50 p-3"},yt={class:"mt-1 text-xl font-semibold text-gray-900"},bt={class:"rounded-lg border border-gray-100 bg-gray-50 p-3"},vt={class:"mt-1 text-xl font-semibold text-red-600"},ht={class:"rounded-lg border border-gray-100 bg-gray-50 p-3"},Ct={class:"mt-1 text-xl font-semibold text-gray-900"},St={class:"mt-4 rounded-lg border border-gray-200 p-4"},wt={class:"space-y-1 text-sm"},kt={class:"text-gray-700"},_t={class:"font-medium text-gray-900"},At={class:"mt-4"},Vt={class:"mt-4 flex items-center justify-between border-t pt-4"},Et={class:"flex items-center gap-2 text-sm text-gray-700"},Ft={class:"rounded-lg border border-gray-200 bg-white p-4 shadow-sm"},Nt={class:"w-full text-sm"},Rt={class:"bg-gray-50"},Dt={key:0,class:"px-4 py-2 text-center text-xs font-medium text-gray-700"},Mt={class:"divide-y divide-gray-200"},It={key:0},Bt={class:"px-4 py-2 text-gray-700"},Ot={class:"px-4 py-2 text-gray-700"},jt={class:"px-4 py-2 text-gray-700"},Ut={class:"px-4 py-2 text-center"},$t={key:0,class:"px-4 py-2 text-center"},Tt=["onClick"],Lt=L({__name:"ClosingVoucher",setup(Pt){const u=J(),C=q(),S=G(),F=H(),N=K(),x=_({openingCash:0}),s=_({shiftStart:"",shiftEndDisplay:"--",openingCash:0,actualClosingCash:0,remarks:"",managerApproved:!1}),i=_({totalSales:0,paymentBreakdown:[],discounts:0,refunds:0,expenses:0,expectedClosingCash:0}),R=g(()=>u.vouchersForCurrentStore),r=g(()=>u.activeShift),y=g(()=>{var n;return!!((n=r.value)!=null&&n.endedAt)}),b=g(()=>S.isManager),w=g(()=>s.actualClosingCash-i.expectedClosingCash),O=g(()=>w.value===0?"text-green-600":Math.abs(w.value)<100?"text-yellow-500":"text-red-600"),D=g(()=>x.openingCash>=0),j=g(()=>!!r.value&&!!r.value.endedAt&&b.value),m=Q(!1),p=n=>{if(!n)return"--";const e=new Date(n);return Number.isNaN(e.getTime())?"--":e.toLocaleString()};function U(){var n;if(!D.value){alert("Opening cash must be zero or greater.");return}u.startShift(Number(x.openingCash)),x.openingCash=((n=u.lastVoucher)==null?void 0:n.actualClosingCash)??0,m.value=!1,k()}function $(){u.endShift(),m.value=!1,k()}function k(){r.value&&(s.shiftStart=p(r.value.start),s.shiftEndDisplay=y.value?p(r.value.endedAt):"--",s.openingCash=r.value.openingCash,m.value=!1,v())}function v(){if(!r.value)return;const n=r.value.endedAt??new Date().toISOString();s.shiftEndDisplay=y.value?p(r.value.endedAt):`${p(n)} (preview)`;const e=u.computeSnapshot({openingCash:Number(s.openingCash),shiftStart:r.value.start,shiftEnd:n});Object.assign(i,e),m.value||(s.actualClosingCash=e.expectedClosingCash)}W(()=>{const n=r.value;n&&(n.endedAt,F.sales,N.expensesForCurrentStore,v())});function T(){var f,o;if(!j.value||!r.value){alert("Only managers can submit the closing voucher after the shift has ended.");return}const n=C.stores.find(M=>M.id===C.currentStoreId),e=u.closeShift({storeId:C.currentStoreId,storeName:(n==null?void 0:n.name)||"Unknown Store",cashierName:((f=S.user)==null?void 0:f.displayName)||((o=S.user)==null?void 0:o.username)||"Cashier",openingCash:Number(s.openingCash),actualClosingCash:Number(s.actualClosingCash),remarks:s.remarks||void 0,managerApproved:s.managerApproved});window.open(`/print/closing/${e.id}`,"_blank"),P()}function P(){var n;s.shiftStart="",s.shiftEndDisplay="--",s.openingCash=0,s.actualClosingCash=0,s.remarks="",s.managerApproved=!1,i.totalSales=0,i.paymentBreakdown=[],i.discounts=0,i.refunds=0,i.expenses=0,i.expectedClosingCash=0,m.value=!1,x.openingCash=((n=u.lastVoucher)==null?void 0:n.actualClosingCash)??0}function z(n){window.open(`/print/closing/${n}`,"_blank")}return X(()=>{var n;F.load(),N.load(),u.setCurrentStore(),x.openingCash=((n=u.lastVoucher)==null?void 0:n.actualClosingCash)??0,r.value&&k()}),(n,e)=>{var f;return d(),l("div",Z,[r.value?(d(),l("div",nt,[y.value?y.value&&!b.value?(d(),l("div",ut,[e[14]||(e[14]=t("h2",{class:"mb-3 text-lg font-semibold text-gray-800"},"Shift Ended",-1)),t("p",null,"Shift ended at "+a(p((f=r.value)==null?void 0:f.endedAt))+".",1),e[15]||(e[15]=t("p",{class:"mt-2"},"Please wait for a manager to review and submit the closing voucher.",-1))])):(d(),l("div",gt,[e[27]||(e[27]=t("h2",{class:"mb-3 text-lg font-semibold text-gray-800"},"Close Shift (Manager)",-1)),t("div",xt,[t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm text-gray-700"},"Shift Start",-1)),t("input",{value:s.shiftStart,type:"text",disabled:"",class:"mt-1 w-full rounded-md border border-gray-300 bg-gray-100 px-3 py-2 text-sm"},null,8,mt)]),t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm text-gray-700"},"Shift End",-1)),t("input",{value:s.shiftEndDisplay,type:"text",disabled:"",class:"mt-1 w-full rounded-md border border-gray-300 bg-gray-100 px-3 py-2 text-sm"},null,8,pt)]),t("div",null,[e[18]||(e[18]=t("label",{class:"block text-sm text-gray-700"},"Opening Cash (Rs)",-1)),c(t("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>s.openingCash=o),type:"number",min:"0",step:"0.01",class:"mt-1 w-full rounded-md border border-gray-300 px-3 py-2 text-sm outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500",onInput:e[2]||(e[2]=o=>{m.value=!1,v()})},null,544),[[h,s.openingCash,void 0,{number:!0}]])]),t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm text-gray-700"},"Actual Cash Counted (Rs)",-1)),c(t("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>s.actualClosingCash=o),type:"number",min:"0",step:"0.01",class:"mt-1 w-full rounded-md border border-gray-300 px-3 py-2 text-sm outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500",onInput:e[4]||(e[4]=o=>m.value=!0)},null,544),[[h,s.actualClosingCash,void 0,{number:!0}]])])]),t("div",ft,[t("div",ct,[e[20]||(e[20]=t("div",{class:"text-xs text-gray-600"},"Total Sales",-1)),t("div",yt,"Rs "+a(i.totalSales.toFixed(2)),1)]),t("div",bt,[e[21]||(e[21]=t("div",{class:"text-xs text-gray-600"},"Expenses",-1)),t("div",vt,"Rs "+a(i.expenses.toFixed(2)),1)]),t("div",ht,[e[22]||(e[22]=t("div",{class:"text-xs text-gray-600"},"Expected Closing Cash",-1)),t("div",Ct," Rs "+a(i.expectedClosingCash.toFixed(2)),1)])]),t("div",St,[e[23]||(e[23]=t("h3",{class:"mb-2 text-sm font-semibold text-gray-700"},"Payment Breakdown",-1)),t("ul",wt,[(d(!0),l(I,null,B(i.paymentBreakdown,o=>(d(),l("li",{key:o.method,class:"flex items-center justify-between"},[t("span",kt,a(o.method),1),t("span",_t,"Rs "+a(o.amount.toFixed(2)),1)]))),128))])]),t("div",At,[e[24]||(e[24]=t("label",{class:"block text-sm text-gray-700"},"Remarks",-1)),c(t("textarea",{"onUpdate:modelValue":e[5]||(e[5]=o=>s.remarks=o),rows:"2",class:"mt-1 w-full rounded-md border border-gray-300 px-3 py-2 text-sm outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500"},null,512),[[h,s.remarks]])]),t("div",Vt,[t("div",null,[e[25]||(e[25]=t("div",{class:"text-sm text-gray-600"},"Difference",-1)),t("div",{class:V(["mt-1 text-xl font-semibold",O.value])},"Rs "+a(w.value.toFixed(2)),3)]),t("label",Et,[c(t("input",{"onUpdate:modelValue":e[6]||(e[6]=o=>s.managerApproved=o),type:"checkbox",class:"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"},null,512),[[Y,s.managerApproved]]),e[26]||(e[26]=A(" Manager Approved ",-1))])]),t("div",{class:"mt-4 flex justify-end gap-2"},[t("button",{class:"rounded-md border border-gray-300 px-4 py-2 text-sm",onClick:v},"Recalculate"),t("button",{class:"rounded-md bg-indigo-600 px-4 py-2 text-sm font-medium text-white",onClick:T}," Submit Voucher ")])])):(d(),l("div",rt,[e[13]||(e[13]=t("h2",{class:"mb-3 text-lg font-semibold text-gray-800"},"Active Shift",-1)),t("div",at,[t("div",null,[e[10]||(e[10]=t("div",{class:"text-xs text-gray-600"},"Shift Start",-1)),t("div",it,a(s.shiftStart),1)]),t("div",null,[e[11]||(e[11]=t("div",{class:"text-xs text-gray-600"},"Opening Cash",-1)),t("div",dt,"Rs "+a(s.openingCash.toFixed(2)),1)]),t("div",null,[e[12]||(e[12]=t("div",{class:"text-xs text-gray-600"},"Current Sales",-1)),t("div",lt,"Rs "+a(i.totalSales.toFixed(2)),1)])]),t("div",{class:"mt-4 flex justify-end"},[t("button",{class:"rounded-md bg-red-600 px-4 py-2 text-sm font-medium text-white",onClick:$}," End Shift ")])]))])):(d(),l("div",tt,[e[9]||(e[9]=t("h2",{class:"mb-3 text-lg font-semibold text-gray-800"},"Start Shift",-1)),t("div",et,[t("div",null,[e[7]||(e[7]=t("label",{class:"block text-sm text-gray-700"},"Opening Cash (Rs)",-1)),c(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>x.openingCash=o),type:"number",min:"0",step:"0.01",class:"mt-1 w-full rounded-md border border-gray-300 px-3 py-2 text-sm outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500"},null,512),[[h,x.openingCash,void 0,{number:!0}]])]),e[8]||(e[8]=t("div",{class:"flex items-end"},[t("p",{class:"text-xs text-gray-500"},[A(" Shift start time will be captured automatically when you press "),t("strong",null,"Start Shift"),A(". ")])],-1))]),t("div",st,[t("button",{disabled:!D.value,class:"rounded-md bg-indigo-600 px-4 py-2 text-sm font-medium text-white disabled:cursor-not-allowed disabled:bg-gray-300",onClick:U}," Start Shift ",8,ot)])])),t("div",Ft,[e[34]||(e[34]=t("h3",{class:"mb-3 text-lg font-semibold text-gray-800"},"Recent Vouchers",-1)),t("table",Nt,[t("thead",Rt,[t("tr",null,[e[28]||(e[28]=t("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-700"},"Date",-1)),e[29]||(e[29]=t("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-700"},"Cashier",-1)),e[30]||(e[30]=t("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-700"},"Sales",-1)),e[31]||(e[31]=t("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-700"},"Difference",-1)),e[32]||(e[32]=t("th",{class:"px-4 py-2 text-center text-xs font-medium text-gray-700"},"Manager",-1)),b.value?(d(),l("th",Dt,"Actions")):E("",!0)])]),t("tbody",Mt,[R.value.length===0?(d(),l("tr",It,[...e[33]||(e[33]=[t("td",{colspan:"6",class:"px-4 py-4 text-center text-gray-500"},"No closing vouchers yet.",-1)])])):E("",!0),(d(!0),l(I,null,B(R.value.slice(-10).reverse(),o=>(d(),l("tr",{key:o.id},[t("td",Bt,a(p(o.shiftEnd)),1),t("td",Ot,a(o.cashierName),1),t("td",jt,"Rs "+a(o.totalSales.toFixed(2)),1),t("td",{class:V(["px-4 py-2 font-semibold",o.difference===0?"text-green-600":"text-red-600"])}," Rs "+a(o.difference.toFixed(2)),3),t("td",Ut,[t("span",{class:V(["inline-flex rounded-full px-2 py-1 text-xs font-medium",o.managerApproved?"bg-green-100 text-green-800":"bg-gray-100 text-gray-600"])},a(o.managerApproved?"Approved":"Pending"),3)]),b.value?(d(),l("td",$t,[t("button",{class:"rounded-md border border-indigo-300 bg-indigo-50 px-3 py-1 text-xs font-medium text-indigo-700 hover:bg-indigo-100",onClick:M=>z(o.id)}," View / Print ",8,Tt)])):E("",!0)]))),128))])])])])}}});export{Lt as default};
